/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'fr.sarainfras.caillou15.java-application-conventions'
    id 'java-library'
    id 'edu.sc.seis.launch4j' version "2.5.4"
    id 'com.github.johnrengelman.shadow' version '7.1.2'
}

repositories {
    flatDir {
        dirs 'lib'
        dirs 'lib/temurin-16.0.2'
    }
}

dependencies {
    implementation 'org.apache.commons:commons-text'
    //implementation ':lib:batik-all.jar'
    implementation project(':utilities')
    //compile fileTree(include: ['*.jar'], dir: 'lib')
    implementation fileTree(dir: 'lib', include: ['*.jar'])
    implementation fileTree(dir: 'lib/temurin-16.0.2', includes: ['*'])
    //compileClasspath(files('lib/*.jar'))
}

application {
    // Define the main class for the application.
    mainClass = 'fr.sarainfras.caillou15.app.App'
}

compileJava {
    options.encoding = 'UTF-8'
}

task customFatJar(type: Jar) {
    manifest {
        attributes 'Main-Class': 'fr.sarainfras.caillou15.app.App'/*application.mainClass*/
    }
    baseName = 'all-in-one-jar'
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    FileTree fileTree = zipTree()
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
    with jar
}

createExe { //used for windows
    mainClassName = 'fr.sarainfras.caillou15.app.App'
    bundledJrePath = 'lib/temurin-16.0.2'
    bundledJre64Bit = true
    jreMinVersion = '16'
    jarTask = tasks['shadowJar']
    copyConfigurable = []
    stayAlive = true
}

tasks.register('copyJDK', Copy) {
    from layout.buildDirectory.dir("lib").get().dir("temurin-16.0.2")
    include "**/*.*"
    into layout.buildDirectory.dir("launch4j").get().dir("lib").dir("temurin-16.0.2")
}

tasks["launch4j"].finalizedBy copyJDK